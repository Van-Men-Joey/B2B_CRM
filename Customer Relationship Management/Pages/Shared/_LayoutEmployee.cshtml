@{
    Layout = null;
    var userName = User.Identity?.Name ?? "Employee";
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - CRM Employee</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap Icons (same as Manager) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

    @RenderSection("Styles", required: false)

    <!-- Employee theme keeps gradient background -->
    <link href="~/css/employee.css" rel="stylesheet" />

    <style>
        /* match Manager/Admin dropdown look */
        .dropdown-menu { background-color: #fff; border: 1px solid #ddd; box-shadow: 0 2px 8px rgba(0,0,0,.15); }
        .dropdown-item { color: #222; }
        .dropdown-item:hover { background-color: #f5f5f5; }
        .dropdown-item.text-danger { color: #dc3545 !important; }

        /* NAVBAR: xanh nước (aqua) gradient */
        .employee-navbar {
            background: linear-gradient(90deg, #0F66F7 0%, #1B8CFF 45%, #00D4FF 100%) !important; /* deep blue -> sky -> aqua */
            box-shadow: 0 6px 18px rgba(0,0,0,.12);
            border-bottom: 1px solid rgba(255,255,255,.12);
        }
        .employee-navbar .navbar-brand,
        .employee-navbar .nav-link { color: #ffffff !important; }
        .employee-navbar .nav-link.active,
        .employee-navbar .nav-link:focus,
        .employee-navbar .nav-link:hover {
            color: #eafff3 !important;
            background: rgba(255,255,255,.12);
            border-radius: .5rem;
        }
    </style>
</head>
<body>
    <!-- Topbar -->
    <nav class="navbar navbar-expand-lg navbar-dark employee-navbar">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center gap-2" asp-page="/Employee/Dashboard">
                CRM Employee
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#empNav" aria-controls="empNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="empNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link @(ViewData["ActiveMenu"] == "Dashboard" ? "active" : "")" asp-page="/Employee/Dashboard">
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @(ViewData["ActiveMenu"] == "Customer" ? "active" : "")" asp-page="/Employee/Customer/Customer">
                            Client / Khách Hàng
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @(ViewData["ActiveMenu"] == "Deal" ? "active" : "")" asp-page="/Employee/Deal/Deal">
                            Deal / Hợp Đồng
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @(ViewData["ActiveMenu"] == "Task" ? "active" : "")" asp-page="/Employee/Task/Index">
                            Task / Công Việc
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @(ViewData["ActiveMenu"] == "Quotation & Contract" ? "active" : "")" asp-page="/Employee/Contract/Index">
                            Quotation & Contract / Hợp Đồng & Báo Giá
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @(ViewData["ActiveMenu"] == "Support" ? "active" : "")" asp-page="/Employee/Support/Index">
                            Support / Hỗ Trợ
                        </a>
                    </li>
                </ul>

                <!-- User Info dropdown (align like Manager/Admin) -->
                <ul class="navbar-nav align-items-center ms-auto">
                    <li class="nav-item me-2 text-white">
                        <span>Xin chào,</span>
                    </li>
                    <li class="nav-item dropdown me-1">
                        <a class="nav-link dropdown-toggle d-flex align-items-center gap-2" href="#" id="empProfileDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle fs-5"></i>
                            <strong>@userName</strong>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="empProfileDropdown">
                            <li>
                                <a class="dropdown-item d-flex align-items-center gap-2" asp-page="/Employee/Profile/Index">
                                    <i class="bi bi-person-lines-fill"></i>
                                    Hồ sơ
                                </a>
                            </li>
                            <li><hr class="dropdown-divider" /></li>
                            <li>
                                <form method="post" asp-page="/Account/Logout" class="m-0">
                                    <button class="dropdown-item text-danger d-flex align-items-center gap-2" type="submit">
                                        <i class="bi bi-box-arrow-right"></i>
                                        Đăng xuất
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main content -->
    <main class="container-fluid py-4 content">
        @RenderBody()
    </main>

    <!-- Hidden form chứa AntiForgeryToken để JavaScript lấy -->
    <form id="antiForgeryForm" method="post" style="display:none">
        @Html.AntiForgeryToken()
    </form>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    @RenderSection("Scripts", required: false)
</body>
</html>

<!-- 🔔 Toast Notification -->
<div aria-live="polite" aria-atomic="true" class="position-relative">
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toast-container">
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="toast align-items-center text-bg-success border-0 show mb-2" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body">
                        @TempData["SuccessMessage"]
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            </div>
        }
        @if (TempData["ErrorMessage"] != null)
        {
            <div class="toast align-items-center text-bg-danger border-0 show mb-2" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body">
                        @TempData["ErrorMessage"]
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            </div>
        }
        @if (TempData["WarningMessage"] != null)
        {
            <div class="toast align-items-center text-bg-warning border-0 show mb-2" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body">
                        @TempData["WarningMessage"]
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            </div>
        }
    </div>
</div>

<!-- Auto-hide Toast -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const toastElList = [].slice.call(document.querySelectorAll('.toast'))
        toastElList.map(function (toastEl) {
            const toast = new bootstrap.Toast(toastEl, { delay: 3000 })
            toast.show()
        })
    })
</script>
